name:  ci pipeline for code quality (sonarqube)

on:
  push:
     branches:
       - master  # Runs pipeline onlu when pushing to master branch
jobs:
   build-deploy:
      runs-on: ubuntu-latest

      steps:
        # Checkout repo
        - name: Checkout code 
          uses: actions/checkout@v3

        # Set up java 
        - name: set up jdk 11
          uses: actions/setup-java@v3
          with: 
            distribution: 'temurin'
            java-version:  '11'
            
        #validate with  maven(update)
        - name: validate the code
          run: mvn validate
          
        #compile with  maven(update)
        - name: compile the code
          run: mvn compile
          
         #test with  maven(update)
        - name: test the code
          run: mvn test
          
          #package with  maven(update)
        - name: package the code
          run: mvn package
        
          #verify the war file
        - name: verify 
          run: ls -l target/   

          # verify the sonar
        -  name: SonarQube Scan
           uses: SonarSource/sonarqube-scan-action@master
           with:
             projectBaseDir: .
              args:>
              -Dsonar.organization=train-ticket
              -Dsonar.projectKey=train-ticker-reservation
             env:  
                SONAR_TOKEN:${{secrets.SONAR_TOKEN }}
                 SONAR_HOST_URL:${{secrets.SONAR_HOST_URL }}

             

       
